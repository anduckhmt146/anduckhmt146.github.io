---
layout: post
title: Framework Thinking - Axon - Randomized Camera Checkout by Id - Constant Time - Insert/Delete/Random O(1)
date: 2025-12-07
categories: coding-practice
---

Here is solutions for Randomized Camera Checkout by Id - Constant Time.

# 1. Understand the problem

âœ… 1. Understand the Problem

- We are building a camera checkout pool that stores camera IDs (integers) and supports:

  - insert(id) â†’ add a camera back to the pool

  - remove(id) â†’ remove a camera when itâ€™s checked out

  - select_random() â†’ return a random available camera ID

- Requirements:

  - These operations will be called very frequently

  - The pool can be very large

  - Duplicates ARE allowed (senior-level add-on)

  - We must achieve O(1) average time for:

    - Insert

    - Remove

    - Get Random

- So this is a high-performance randomized data structure problem.

# 2. Clarify constraints, asks 4 - 5 questions including edge cases.

Edge cases to consider

1. What happens if â€œGetRandomâ€ API is called when collection is empty
   They will typically note here that the return type of â€œintâ€ is unsuitable. Ask what the options are assuming the API is set in stone. (Good answer: Throw an exception/abort. Bad answer: Just reserve some integers, like 0, that canâ€™t be put in the collection).

2. What happens if remove is called on the last element in the collection

3. What happens if I try and remove an integer that is not in the collection

4. What happens if I try to insert the same integer twice

# 3. Explore examples.

1. Example 1

```python
insert(10)
insert(20)
insert(10)
insert(30)

Pool = [10, 20, 10, 30]
```

2. Example 2

```python
remove(10)

```

- Only one 10 is removed:

- Pool could become: [30, 20, 10]

3. Example 3

- remove(99) â†’ False

- remove(20) â†’ True

# 4. Brainstorm 2 - 3 solutions, naive solution first and optimize later. Explain the key idea of each solution.

## 4.1. Solution 1: Naive (List Only)

- Use a list:

  - Insert â†’ append â†’ O(1)

  - Random â†’ random.choice â†’ O(1)

  - Remove â†’ list.remove(id) â†’ O(n) (linear scan)

## 4.2. ðŸŸ¡ Solution 2: HashMap Only

```python
id â†’ count
```

- Insert â†’ O(1)

- Remove â†’ O(1)

âŒ Random â†’ Not possible in O(1), because:

    - You donâ€™t know how many total values exist

    - You canâ€™t directly pick a random occurrence

âŒ Fails random selection requirement

## 4.3. Solution 3: Optimized O(1)

We need:

- Random access â†’ use a list

- Fast lookup/removal with duplicates â†’ use a hashmap of index sets

Data Structures:

    - arr: dynamic list of all values

    - pos: hashmap â†’ id -> set of indices in arr

Why This Works:

- Random selection â†’ random index in arr

- Insert â†’ append to arr, store index in pos

- Remove â†’ use swap-with-last trick to delete in O(1)

# 5. Implement solutions.

```python
import random
from collections import defaultdict

class CameraPool:

    def __init__(self):
        self.arr = []                      # stores all camera ids
        self.pos = defaultdict(set)       # id -> set of indices

    def insert(self, id: int) -> bool:
        existed = id in self.pos and len(self.pos[id]) > 0

        self.arr.append(id)
        self.pos[id].add(len(self.arr) - 1)

        return not existed

    def remove(self, id: int) -> bool:
        if id not in self.pos or len(self.pos[id]) == 0:
            return False

        # Get one index of this id
        remove_idx = self.pos[id].pop()
        last_val = self.arr[-1]

        # Move last element to the removed spot
        self.arr[remove_idx] = last_val

        # Update last_val index set
        self.pos[last_val].add(remove_idx)
        self.pos[last_val].discard(len(self.arr) - 1)

        # Remove last element
        self.arr.pop()

        return True

    def select_random(self) -> int:
        return random.choice(self.arr)

```

- Idea: XoÃ¡ cÃ¡i index cuá»‘i, láº¥y last_val gÃ¡n vÃ´ cÃ¡i remove idx.

# 6. Dry run testcases.

```python
arr = [5, 10, 5, 20]

pos = {
  5: {0, 2},
  10: {1}
  20: {3}
}
```

- remove(5)

```python
arr = [5, 10, 5, 20]

=> arr = [5, 10, 20, 20]

=> pop the last value => [5, 10, 20]

pos = {
  5: {0},
  10: {1}
  20: {2}
}
```

=> Remove default value in a dict O(1)
